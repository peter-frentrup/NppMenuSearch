<Project Sdk="Microsoft.NET.Sdk">
  <!--
    MSBuild reference for .NET SDK projects
    https://learn.microsoft.com/en-us/dotnet/core/project-sdk/msbuild-props
  -->

  <PropertyGroup>
    <TargetFramework>net40</TargetFramework>
    <!-- Prevent 'net40' subfolder in output path -->
    <AppendTargetFrameworkToOutputPath>false</AppendTargetFrameworkToOutputPath>
    <Platforms>x86;x64</Platforms>
    <UseWindowsForms>true</UseWindowsForms>
    <!-- .NET Framework 4.0 -> C# 7.3 (the last version officially supported) -->
    <LangVersion>7.3</LangVersion>
    <!--
      Code quality analysis (requires Microsoft.CodeAnalysis.NetAnalyzers package for .NET Framework)
      https://docs.microsoft.com/en-us/dotnet/fundamentals/code-analysis/overview#code-quality-analysis
    -->
    <EnableNETAnalyzers>true</EnableNETAnalyzers>
    <AnalysisMode>Recommended</AnalysisMode>
    <!--
      Code-style analysis via .editorconfig
      https://docs.microsoft.com/en-us/dotnet/fundamentals/code-analysis/overview#code-style-analysis
    -->
    <EnforceCodeStyleInBuild>true</EnforceCodeStyleInBuild>
  </PropertyGroup>

  <!-- Assembly Information. Replacement for AssemblyInfo.cs -->
  <PropertyGroup>
    <Version>0.9.8</Version>
    <AssemblyTitle>Notepad++ Menu Search Plugin</AssemblyTitle>
    <Copyright>Copyright © Peter Frentrup 2013-2025</Copyright>
  </PropertyGroup>

  <!--
    DllExport will warn when using DebugType=portable (default for .NET SDK projects).
    net.r_eg.DllExport.targets : Export warning EXP0022: RunIlAsm: Possibly invalid PDB. Check the DebugType or use a different assembler
    Set DebugType to 'full' for Debug and 'pdbonly' for Release to avoid this warning until DllExport is fixed.
  -->
  <PropertyGroup Condition="'$(Configuration)' == 'Debug'">
    <DefineConstants>DEBUG;TRACE</DefineConstants>
    <DebugType>full</DebugType>
    <DebugSymbols>true</DebugSymbols>
  </PropertyGroup>

  <PropertyGroup Condition="'$(Configuration)' == 'Release'">
    <DefineConstants>TRACE</DefineConstants>
    <DebugType>pdbonly</DebugType>
    <Optimize>true</Optimize>
  </PropertyGroup>

  <ItemGroup>
    <!--
      .NET SDK auto-includes the following files as None items by default, thus use `Update` instead of `Include`.
      https://learn.microsoft.com/en-us/dotnet/core/project-sdk/overview#default-includes-and-excludes
    -->
    <None Update="Localization\NppMenuSearch.*.xml">
      <!-- Link is used to flatten the output structure -->
      <TargetPath>%(Filename)%(Extension)</TargetPath>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
  </ItemGroup>

  <ItemGroup>
    <!-- Original UnmanagedExports logs a false positive error which fails the build. error : Microsoft.Build.Utilities.ToolLocationHelper could not find ildasm.exe. -->
    <PackageReference Include="UnmanagedExports.Repack" Version="1.0.4" IncludeAssets="build" PrivateAssets="All" GeneratePathProperty="true" />
    <!-- Add net40 .NET Framework Reference Assemblies which are no longer available in Visual Studio 2022+ -->
    <PackageReference Include="Microsoft.NETFramework.ReferenceAssemblies.net40" Version="1.0.3" PrivateAssets="All" />
    <!-- Enable .NET code quality analyzers for .NET Framework (not needed for .NET 5+) -->
    <PackageReference Include="Microsoft.CodeAnalysis.NetAnalyzers" Version="9.0.0" PrivateAssets="All" />
  </ItemGroup>

  <ItemGroup>
    <!-- Needed just for DllExportAttribute and is not required at runtime. Alternatively, DllExportAttribute can be defined directly in the code. -->
    <Reference Include="RGiesecke.DllExport.Metadata">
      <HintPath>$(PkgUnmanagedExports_Repack)\lib\net452\RGiesecke.DllExport.Metadata.dll</HintPath>
      <Private>False</Private>
    </Reference>
  </ItemGroup>

</Project>
